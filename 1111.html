<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Приложение</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 20px;
            max-width: 400px;
        }
        input, button {
            margin-top: 10px;
            padding: 10px;
            font-size: 16px;
            width: 100%;
        }
        .info {
            margin-bottom: 20px;
            padding: 10px;
            background-color: #f0f8ff;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>Добро пожаловать!</h1>
    <div class="info" id="user-info">
        Загрузка данных...
    </div>
    <form id="update-points-form">
        <label for="points">Добавить очков:</label>
        <input type="number" id="points" placeholder="Введите количество очков" required>
        <button type="submit">Отправить</button>
    </form>

    <script>
        // URL API бота для получения и отправки данных
        const botApiUrl = "https://4f52-213-109-225-82.ngrok-free.app/get_data"; // Замените на URL API вашего бота
        const botSendDataUrl = "https://4f52-213-109-225-82.ngrok-free.app/send_data"; // Замените на URL для отправки данных боту

        // Элементы для отображения данных и формы
        const userInfo = document.getElementById("user-info");
        const form = document.getElementById("update-points-form");
        const pointsInput = document.getElementById("points");

        // Переменная для хранения данных пользователя
        let userData = {};

        // Функция для получения данных от бота
        async function fetchData() {
            try {
                const response = await fetch(botApiUrl);
                console.log("Статус ответа при получении данных:", response.status);

                if (response.ok) {
                    userData = await response.json();
                    console.log("Полученные данные:", userData);

                    // Проверка наличия данных и их типов
                    if (typeof userData.id !== 'number' || typeof userData.username !== 'string') {
                        throw new Error("Неверные данные пользователя (id или username)");
                    }

                    // Убедитесь, что points является числом
                    userData.points = parseFloat(userData.points) || 0;

                    displayUserData();
                } else {
                    const errorText = await response.text();
                    userInfo.innerText = `Ошибка загрузки: ${errorText}`;
                    console.error("Ошибка получения данных:", errorText);
                }
            } catch (error) {
                userInfo.innerText = `Ошибка: ${error.message}`;
                console.error("Ошибка fetch:", error);
            }
        }

        // Функция для отображения данных на экране
        function displayUserData() {
            userInfo.innerHTML = `
                <p><strong>ID:</strong> ${userData.id}</p>
                <p><strong>Имя:</strong> ${userData.username}</p>
                <p><strong>Очки:</strong> ${userData.points}</p>
            `;
        }

        // Обработчик отправки формы
        form.addEventListener("submit", async (event) => {
            event.preventDefault();

            const additionalPoints = parseInt(pointsInput.value, 10);
            if (isNaN(additionalPoints) || additionalPoints <= 0) {
                alert("Введите положительное число.");
                return;
            }

            const updatedData = {
                id: userData.id,
                username: userData.username,
                points: userData.points + additionalPoints
            };

            console.log("Отправляемые данные:", updatedData);

            try {
                const response = await fetch(botSendDataUrl, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(updatedData)
                });

                console.log("Статус ответа сервера:", response.status);

                if (response.ok) {
                    const result = await response.json();
                    alert("Очки успешно обновлены!");
                    userData.points += additionalPoints;
                    displayUserData();
                    console.log("Ответ сервера:", result);
                } else {
                    const errorText = await response.text();
                    alert(`Ошибка при отправке данных: ${errorText}`);
                    console.error("Ошибка при отправке:", errorText);
                }
            } catch (error) {
                alert(`Ошибка: ${error.message}`);
                console.error("Ошибка запроса:", error);
            }

            pointsInput.value = "";
        });

        // Загрузка данных при старте
        fetchData();
    </script>
</body>


</html>
